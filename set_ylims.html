
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Setting y-axis limits &#8212; dmslogo 0.6.0 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="dmslogo package" href="dmslogo.html" />
    <link rel="prev" title="Plotting negative values" href="negative_values.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="Setting-y-axis-limits">
<h1>Setting y-axis limits<a class="headerlink" href="#Setting-y-axis-limits" title="Permalink to this headline">¶</a></h1>
<p>This example shows how to intelligently set y-axis limits when we are trying to hightlight sites of selection and some of the samples are mostly “noise.”</p>
<p>First, import <code class="docutils literal notranslate"><span class="pre">dmslogo</span></code> along with the other necessary packages:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">import</span> <span class="nn">dmslogo</span>
<span class="kn">import</span> <span class="nn">dmslogo.utils</span>
</pre></div>
</div>
</div>
<p>Read in some real immune selection data for influenza HA:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ha_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;input_files/HA_serum_diffsel.csv&#39;</span><span class="p">)</span>

<span class="n">ha_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sample</th>
      <th>isite</th>
      <th>site</th>
      <th>wildtype</th>
      <th>mutation</th>
      <th>mutdiffsel</th>
      <th>positive_diffsel</th>
      <th>negative_diffsel</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>age 2.2</td>
      <td>0</td>
      <td>-16</td>
      <td>M</td>
      <td>A</td>
      <td>-1.525</td>
      <td>0.0</td>
      <td>-16.841</td>
    </tr>
    <tr>
      <th>1</th>
      <td>age 2.2</td>
      <td>0</td>
      <td>-16</td>
      <td>M</td>
      <td>C</td>
      <td>-1.040</td>
      <td>0.0</td>
      <td>-16.841</td>
    </tr>
    <tr>
      <th>2</th>
      <td>age 2.2</td>
      <td>0</td>
      <td>-16</td>
      <td>M</td>
      <td>D</td>
      <td>-1.675</td>
      <td>0.0</td>
      <td>-16.841</td>
    </tr>
    <tr>
      <th>3</th>
      <td>age 2.2</td>
      <td>0</td>
      <td>-16</td>
      <td>M</td>
      <td>E</td>
      <td>-1.050</td>
      <td>0.0</td>
      <td>-16.841</td>
    </tr>
    <tr>
      <th>4</th>
      <td>age 2.2</td>
      <td>0</td>
      <td>-16</td>
      <td>M</td>
      <td>F</td>
      <td>-0.833</td>
      <td>0.0</td>
      <td>-16.841</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Add a site label that gives both the site number and wildtype identity, and also indicate which sites to show in the logo plots:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sites_to_show</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;157&#39;</span><span class="p">,</span> <span class="s1">&#39;158&#39;</span><span class="p">,</span> <span class="s1">&#39;159&#39;</span><span class="p">,</span> <span class="s1">&#39;160&#39;</span><span class="p">,</span> <span class="s1">&#39;188&#39;</span><span class="p">,</span> <span class="s1">&#39;189&#39;</span><span class="p">,</span> <span class="s1">&#39;190&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;192&#39;</span><span class="p">,</span> <span class="s1">&#39;193&#39;</span><span class="p">,</span> <span class="s1">&#39;194&#39;</span><span class="p">,</span> <span class="s1">&#39;221&#39;</span><span class="p">,</span> <span class="s1">&#39;222&#39;</span><span class="p">,</span> <span class="s1">&#39;223&#39;</span><span class="p">]</span>

<span class="n">ha_df</span> <span class="o">=</span> <span class="p">(</span><span class="n">ha_df</span>
         <span class="o">.</span><span class="n">assign</span><span class="p">(</span>
             <span class="n">site_label</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;wildtype&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;site&#39;</span><span class="p">],</span>
             <span class="n">to_show</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;site&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">sites_to_show</span><span class="p">)</span>
             <span class="p">)</span>
         <span class="p">)</span>
</pre></div>
</div>
</div>
<p>Now use <a class="reference external" href="https://jbloomlab.github.io/dmslogo/dmslogo.facet.html#dmslogo.facet.facet_plot">dmslogo.facet.facet_plot</a> to facet line and logo plots for the samples, using <code class="docutils literal notranslate"><span class="pre">clip_negative_heights</span></code> to only show the positive values. Here we just use the “default” setting for the y-axis limits, which gives a reasonable looking plot:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">dmslogo</span><span class="o">.</span><span class="n">facet_plot</span><span class="p">(</span>
                <span class="n">ha_df</span><span class="p">,</span>
                <span class="n">gridrow_col</span><span class="o">=</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span>
                <span class="n">x_col</span><span class="o">=</span><span class="s1">&#39;isite&#39;</span><span class="p">,</span>
                <span class="n">show_col</span><span class="o">=</span><span class="s1">&#39;to_show&#39;</span><span class="p">,</span>
                <span class="n">draw_line_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;height_col&#39;</span><span class="p">:</span> <span class="s1">&#39;positive_diffsel&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;xtick_col&#39;</span><span class="p">:</span> <span class="s1">&#39;site&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;ylabel&#39;</span><span class="p">:</span> <span class="s1">&#39;immune selection&#39;</span><span class="p">},</span>
                <span class="n">draw_logo_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;letter_col&#39;</span><span class="p">:</span> <span class="s1">&#39;mutation&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;letter_height_col&#39;</span><span class="p">:</span> <span class="s1">&#39;mutdiffsel&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;xtick_col&#39;</span><span class="p">:</span> <span class="s1">&#39;site_label&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;xlabel&#39;</span><span class="p">:</span> <span class="s1">&#39;site&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;ylabel&#39;</span><span class="p">:</span> <span class="s1">&#39;immune selection&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;clip_negative_heights&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
                <span class="n">share_ylabel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">share_xlabel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">share_ylim_across_rows</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/set_ylims_7_0.png" src="_images/set_ylims_7_0.png" />
</div>
</div>
<p>But now let’s add a sample where all the selection is just “noise”, as is the case if there really isn’t any selection at a site. We create and add this noisy sample by just randomly modifying the selection values for one of the real samples:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># seed for reproducible output</span>

<span class="n">noise_sample</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">ha_df</span>
    <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;sample == &quot;age 64&quot;&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">sample</span><span class="o">=</span><span class="s1">&#39;noisy sample&#39;</span><span class="p">,</span>
            <span class="n">mutdiffsel</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;mutdiffsel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span>
            <span class="n">positive_mutdiffsel</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;mutdiffsel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">lower</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">negative_mutdiffsel</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">&#39;mutdiffsel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">upper</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
            <span class="n">positive_diffsel</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;site&#39;</span><span class="p">)[</span><span class="s1">&#39;positive_mutdiffsel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s1">&#39;sum&#39;</span><span class="p">),</span>
            <span class="n">negative_diffsel</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;site&#39;</span><span class="p">)[</span><span class="s1">&#39;negative_mutdiffsel&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s1">&#39;sum&#39;</span><span class="p">)</span>
            <span class="p">)</span>
    <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;positive_mutdiffsel&#39;</span><span class="p">,</span> <span class="s1">&#39;negative_mutdiffsel&#39;</span><span class="p">])</span>
    <span class="p">)</span>

<span class="n">noise_df</span> <span class="o">=</span> <span class="n">ha_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">noise_sample</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Now plot the data including that noisy sample:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">dmslogo</span><span class="o">.</span><span class="n">facet_plot</span><span class="p">(</span>
                <span class="n">noise_df</span><span class="p">,</span>
                <span class="n">gridrow_col</span><span class="o">=</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span>
                <span class="n">x_col</span><span class="o">=</span><span class="s1">&#39;isite&#39;</span><span class="p">,</span>
                <span class="n">show_col</span><span class="o">=</span><span class="s1">&#39;to_show&#39;</span><span class="p">,</span>
                <span class="n">draw_line_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;height_col&#39;</span><span class="p">:</span> <span class="s1">&#39;positive_diffsel&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;xtick_col&#39;</span><span class="p">:</span> <span class="s1">&#39;site&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;ylabel&#39;</span><span class="p">:</span> <span class="s1">&#39;immune selection&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;show_color&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
                <span class="n">draw_logo_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;letter_col&#39;</span><span class="p">:</span> <span class="s1">&#39;mutation&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;letter_height_col&#39;</span><span class="p">:</span> <span class="s1">&#39;mutdiffsel&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;xtick_col&#39;</span><span class="p">:</span> <span class="s1">&#39;site_label&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;xlabel&#39;</span><span class="p">:</span> <span class="s1">&#39;site&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;ylabel&#39;</span><span class="p">:</span> <span class="s1">&#39;immune selection&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;clip_negative_heights&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
                <span class="n">share_ylabel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">share_xlabel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">share_ylim_across_rows</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/set_ylims_11_0.png" src="_images/set_ylims_11_0.png" />
</div>
</div>
<p>The above plot doesn’t look good. The reason is that it makes sense to scale the upper y-axis limit to the maximum data value when there are truly a few sites of strong selection. But when everything is actually noise, we want all the values to be low, and not to scale the y-axis limit to the maximum data value.</p>
<p>This can be done using a <a class="reference external" href="https://jbloomlab.github.io/dmslogo/dmslogo.utils.html#dmslogo.utils.AxLimSetter">dmslogo.utils.AxLimSetter</a>. The docs linked to for that class explains exactly how it works, but the idea is as follows: this class enables us to make the limits for noisy data much higher than any of the data points. The approach is premised on the idea that if there is real selection, a few sites should have much greater signal than all other sites. To do this, the setters enable us
to specify that the axis limit should be set such that some quantile of the data is at some fraction of the axis height. For instance, a reasonable approach is to set the y-axis such that the 50th percentile (0.5 quantile) of the site-level selection is at 5% (0.05 fraction) of the total data height <strong>or</strong> to the maximum of the data, whichever is larger. This means for noisy samples where no values are much greater than the 50th percentile, the axis limit will be far above the data. Here we
create such a setter, and then use it to set the limits on the line plot (which is the plot that contains all sites):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ylim_setter</span> <span class="o">=</span> <span class="n">dmslogo</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">AxLimSetter</span><span class="p">(</span><span class="n">max_from_quantile</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">))</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">dmslogo</span><span class="o">.</span><span class="n">facet_plot</span><span class="p">(</span>
                <span class="n">noise_df</span><span class="p">,</span>
                <span class="n">gridrow_col</span><span class="o">=</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span>
                <span class="n">x_col</span><span class="o">=</span><span class="s1">&#39;isite&#39;</span><span class="p">,</span>
                <span class="n">show_col</span><span class="o">=</span><span class="s1">&#39;to_show&#39;</span><span class="p">,</span>
                <span class="n">draw_line_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;height_col&#39;</span><span class="p">:</span> <span class="s1">&#39;positive_diffsel&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;xtick_col&#39;</span><span class="p">:</span> <span class="s1">&#39;site&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;ylabel&#39;</span><span class="p">:</span> <span class="s1">&#39;immune selection&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;ylim_setter&#39;</span><span class="p">:</span> <span class="n">ylim_setter</span><span class="p">,</span>
                                  <span class="s1">&#39;show_color&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">},</span>
                <span class="n">draw_logo_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;letter_col&#39;</span><span class="p">:</span> <span class="s1">&#39;mutation&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;letter_height_col&#39;</span><span class="p">:</span> <span class="s1">&#39;mutdiffsel&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;xtick_col&#39;</span><span class="p">:</span> <span class="s1">&#39;site_label&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;xlabel&#39;</span><span class="p">:</span> <span class="s1">&#39;site&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;ylabel&#39;</span><span class="p">:</span> <span class="s1">&#39;immune selection&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;clip_negative_heights&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
                <span class="n">share_ylabel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">share_xlabel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">share_ylim_across_rows</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/set_ylims_13_0.png" src="_images/set_ylims_13_0.png" />
</div>
</div>
<p>The plot above looks much better. The axis limits for the three samples with “real” selection aren’t changed at all because there are actually a few sites of strong selection that greatly exceed the selection at the 50th percentile site. But for the noisy sample, since all of the selection is around the 50th percentile, the axis limit is much above the data.</p>
<p>If we are <strong>only</strong> showing logo plots, then setting the limits using the above method won’t work if the logo plots have already been subset to just the values of greatest interest. Rather, we want to compute the limits using the setter on <strong>all</strong> the data (see <a class="reference external" href="https://jbloomlab.github.io/dmslogo/dmslogo.utils.html#dmslogo.utils.AxLimSetter">dmslogo.utils.AxLimSetter</a> for how to do this), and then pass those limits to the creation of the logo plots. So here is how we would do this if faceting
logo plots:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># get y-limits for each sample using `ylim_setter` on the positive site diffsel</span>
<span class="n">ylims</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">sample</span><span class="p">,</span> <span class="n">sample_df</span> <span class="ow">in</span> <span class="n">noise_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;sample&#39;</span><span class="p">):</span>
    <span class="n">site_diffsel</span> <span class="o">=</span> <span class="n">sample_df</span><span class="p">[[</span><span class="s1">&#39;site&#39;</span><span class="p">,</span> <span class="s1">&#39;positive_diffsel&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()[</span><span class="s1">&#39;positive_diffsel&#39;</span><span class="p">]</span>
    <span class="n">ylims</span><span class="p">[</span><span class="n">sample</span><span class="p">]</span> <span class="o">=</span> <span class="n">ylim_setter</span><span class="o">.</span><span class="n">get_lims</span><span class="p">(</span><span class="n">site_diffsel</span><span class="p">)</span>

<span class="c1"># now make facet plot passing the ylimits via `set_ylims`</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">dmslogo</span><span class="o">.</span><span class="n">facet_plot</span><span class="p">(</span>
                <span class="n">noise_df</span><span class="p">,</span>
                <span class="n">gridrow_col</span><span class="o">=</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span>
                <span class="n">x_col</span><span class="o">=</span><span class="s1">&#39;isite&#39;</span><span class="p">,</span>
                <span class="n">show_col</span><span class="o">=</span><span class="s1">&#39;to_show&#39;</span><span class="p">,</span>
                <span class="n">draw_logo_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;letter_col&#39;</span><span class="p">:</span> <span class="s1">&#39;mutation&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;letter_height_col&#39;</span><span class="p">:</span> <span class="s1">&#39;mutdiffsel&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;xtick_col&#39;</span><span class="p">:</span> <span class="s1">&#39;site_label&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;xlabel&#39;</span><span class="p">:</span> <span class="s1">&#39;site&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;ylabel&#39;</span><span class="p">:</span> <span class="s1">&#39;immune selection&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;clip_negative_heights&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
                <span class="n">share_ylabel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">share_xlabel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">share_ylim_across_rows</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">set_ylims</span><span class="o">=</span><span class="n">ylims</span><span class="p">,</span>
                <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/set_ylims_15_0.png" src="_images/set_ylims_15_0.png" />
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="index.html">
    <img class="logo" src="_static/BloomLogo.jpg" alt="Logo"/>
    
    <h1 class="logo logo-name">dmslogo</h1>
    
  </a>
</p>



<p class="blurb">Sequence logos for deep mutational scanning</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=jbloomlab&repo=dmslogo&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





    

<p>
<a class="badge" href="https://travis-ci.org/jbloomlab/dmslogo">
    <img
        alt="https://secure.travis-ci.org/jbloomlab/dmslogo.svg?branch=master"
        src="https://secure.travis-ci.org/jbloomlab/dmslogo.svg?branch=master"
    />
</a>
</p>


<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="dmslogo.html">dmslogo package</a></li>
<li class="toctree-l1"><a class="reference internal" href="package_index.html">package index</a></li>
<li class="toctree-l1"><a class="reference internal" href="acknowledgments.html">Acknowledgements</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="examples.html">Examples</a><ul>
      <li>Previous: <a href="negative_values.html" title="previous chapter">Plotting negative values</a></li>
      <li>Next: <a href="dmslogo.html" title="next chapter">dmslogo package</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019--2021, Bloom lab.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.2.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/set_ylims.nblink.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/jbloomlab/dmslogo" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>